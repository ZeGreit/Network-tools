#!/bin/bash

### Creates hosts file from config files generated by get interfaces all command on Juniper NetScreen OS collected by NetScr-coll script and placed into fw/NetScr folder


a=`ls ../fw/NetScr/fw* | grep -v VR$`

for file in $a; do

dos2unix $file 2>/dev/null

cat $file | while read line;
do 

IPt=`echo $line | awk '{print $2}'`

if [[ "$line" != *0.0.0.0"/"0* ]] && [[ "$line" == *"."*"."*"."*"/"* ]]
then

devicet=$file
device=${devicet##*"/"}
#device=`echo $device | sed -e 's/\.tmp//'`
If=`echo $line | awk '{print $1}'`
#echo $If
#VR=`grep $If ../fw/NetScr/$device-VR`
i=1
while [[ "$VR" != *-vr"("* ]];do
i=$i
Int=`echo $If | sed -e 's/eth/ethernet/'`
VR=`cat ../fw/NetScr/$device-VR | grep -B $i $Int | head -n 1 | sed -e 's/^//'`
#| awk '{print $1}'`
#echo "grep -B $i $If ../fw/NetScr/$device-VR | head -n 1| awk '{print $1}'"
i=`echo $i+1|bc`
done
#echo $VR
VR=`echo $VR | sed -e 's/(.*$//'`
#echo $VR

IP=${IPt%"/"*}
zonet=`echo $line | awk '{print $3}'`
vsys=`echo $line | awk '{print $8}'`
if [[ "$vsys" == "" ]];then
vsys=Root
fi
zone=${zonet%"-"*}
state=`echo $line | awk '{print $6}'`

function vsysx {
#if [[ "$zonet" == *"~"* ]]
#then
echo $IP\|$device\|$vsys\|$VR\|$If\|
#else
#echo $IP" "$device--$vsys--$zone--$If
#fi
}

function novsys {
#if [[ "$zonet" == *"~"* ]]
#then
echo $IP\|$device\|Root\|$VR\|$If\|
#else
#echo $IP" "$device--$zone--$If
#fi
}

if [[ "$state" == U ]];then
if [[ "$vsys" == Root ]]
then
novsys
VR=""
else
vsysx
VR=""
fi
fi
fi
done
done
