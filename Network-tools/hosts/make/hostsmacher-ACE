#!/bin/bash

### Creates hosts file from config files generated by show running-config command on Cisco ACE loadbalancers


a=`(ls ../core/lb*cfg)`

for file in $a; do

#dos2unix $file 2>/dev/null

cat $file | while read line;
do 
devicet=${file%"."*}
device=${devicet##*"/"}
dev=`echo $device | sed 's/-/ /' | awk '{print $1}'`
vdc=`echo $device | sed 's/-/ /' | awk '{print $2}'`
if [[ "$line" == interface* ]]
then
If=`echo $line | awk '{print $2$3}'`
fi

if [[ "$line" == ip" "address* ]]
then
mask=`echo $line | awk '{print $4}'`
if [[ "$mask" != "" ]];then
ip=`echo $line | awk '{print $3}'`
echo $ip\|$dev\|$vdc\|\|$If\|
fi
fi

if [[ "$line" == alias* ]]
then
ip=`echo $line | awk '{print $2}'`
echo $ip\|$dev\|$vdc\|\|$If\|
fi

done
done
